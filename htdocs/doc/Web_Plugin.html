<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#_test_it_now">Test it NOW</a></li>
<li><a href="#_supported_browsers">Supported browsers</a></li>
<li><a href="#_faq">FAQ</a>
<ul class="sectlevel1">
<li><a href="#_what_about_webgl">1. What about WebGL?</a></li>
<li><a href="#_do_we_install_a_single_plugin_handling_all_games_developed_using_cge_or_is_every_game_a_separate_plugin">2. Do we install a single plugin, handling all games developed using CGE, or is every game a separate plugin?</a></li>
</ul>
</li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><strong>DEPRECATED.</strong> As the NPAPI support is removed from all the major browsers (Google Chrome, Firefox&#8230;&#8203;), so this is no longer a viable technology. The support will be removed from CGE at some point in early 2021. The future for CGE in web browser lies in pas2js, see <a href="https://castle-engine.io/wp/2020/07/20/pas2js-with-generics-rocks-and-makes-castle-game-engine-for-webgl-possible/">this CGE news post</a>, and we will go for it in 2021. An alternative venue may also appear if FPC will support WebAssembly (directly or by LLVM).</p>
</div>
<div class="paragraph">
<p>You can create web browser plugin (NPAPI) to run your game inside a web browser. Besides making your game visually a part of the web page, it also allows to integrate with the webpage environment&#8201;&#8212;&#8201;for example, your game can communicate with Facebook, when being run inside a Facebook game canvas.</p>
</div>
<div class="paragraph">
<p>If you&#8217;d like to try the web plugin (NPAPI) support in our engine anyway, go ahead:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#test-it-now">Test it NOW</a></p>
</li>
<li>
<p><a href="#supported-browsers">Supported browsers</a></p>
</li>
<li>
<p><a href="#faq">FAQ</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="#what-about-webgl">What about WebGL?</a></p>
</li>
<li>
<p><a href="#do-we-install-a-single-plugin-handling-all-games-developed-using-cge-or-is-every-game-a-separate-plugin">Do we install a single plugin, handling all games developed using CGE, or is every game a separate plugin?</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<h1 id="_test_it_now" class="sect0">Test it NOW</h1>
<div class="openblock partintro">
<div class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Get the latest engine</strong> (binary from <a href="https://castle-engine.io/" class="bare">https://castle-engine.io/</a> or sources from <a href="https://github.com/castle-engine/castle-engine/" class="bare">https://github.com/castle-engine/castle-engine/</a> )</p>
</li>
<li>
<p>Enter the castle_game_engine/examples/plugin/cge_3d_viewer/ directory.</p>
</li>
<li>
<p><strong>Compile the plugin</strong> with "castle-engine compile --plugin" command. Add "--mode=debug" if you want:) This creates a DLL (Windows) or SO (Linux) file with plugin code. You don&#8217;t need to install any special tools to build a plugin, a standard FPC installation is cool!
(In case of compilation problems in CastleWindow, just "make clean" inside castle_game_engine/ directory to force recomplation of CastleWindow for the plugin. The need for this will disappear soon.)</p>
</li>
<li>
<p><strong>Install the plugin</strong> (useful command to continously compile + test) by "castle-engine install --plugin". On Windows, this installs by adding appropriate registry keys. On Linux, the plugin is installed by simply copying it to $HOME/.mozilla/plugins/ .
You can now <strong>confirm that it&#8217;s installed OK</strong> by looking at "about:config" (Firefox) or chrome://plugnis (Google Chrome). On Google Chrome, remember to turn on NPAPI flag (see the instructions at the bottom of <a href="https://support.google.com/chrome/answer/6213033?hl=en" class="bare">https://support.google.com/chrome/answer/6213033?hl=en</a> ).</p>
</li>
<li>
<p>Finally, see the plugin in action! Simply <strong>open the file &#8230;&#8203;examples/plugin/cge_3d_viewer/index.html</strong> in your browser.</p>
</li>
</ol>
</div>
</div>
</div>
<h1 id="_supported_browsers" class="sect0">Supported browsers</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>The plugin works on Windows and Linux (and other Unix systems using X11). Supported browsers are Firefox and Google Chrome. For Google Chrome, you now need to enable <em>the NPAPI flag</em> (see the bottom of see the instructions at the bottom of <a href="https://support.google.com/chrome/answer/6213033?hl=en" class="bare">https://support.google.com/chrome/answer/6213033?hl=en</a>).</p>
</div>
<div class="paragraph">
<p>The plugin should work in any browser supporting NPAPI plugins. As for the operating systems, it can be made to work on any system supported by our engine&#8201;&#8212;&#8201;in particular it can be adjusted to macOS (you just need to implement CastleWindow backend for Cocoa, see <a href="http://castle-engine.sourceforge.net/macosx_requirements.php" class="bare">http://castle-engine.sourceforge.net/macosx_requirements.php</a>).</p>
</div>
<div class="paragraph">
<p>As the NPAPI technology goes away, we don&#8217;t plan to work on it more at this point.</p>
</div>
</div>
</div>
<h1 id="_faq" class="sect0">FAQ</h1>
<div class="sect1">
<h2 id="_what_about_webgl">1. What about WebGL?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>"WebGL" means compiling code to JavaScript (asm.js) or using WebAssembly (which is similar to JavaScript in functionality, but is a binary set of  instructions, doesn&#8217;t need to be parsed) and then using WebGL (OpenGL(ES)-like API for JavaScript) for rendering.</p>
</div>
<div class="paragraph">
<p>This is the future of having CGE running in a web browser.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One option is using pas2js, and we already experimented with it and it should be cool already: <a href="https://castle-engine.io/wp/2020/07/20/pas2js-with-generics-rocks-and-makes-castle-game-engine-for-webgl-possible/" class="bare">https://castle-engine.io/wp/2020/07/20/pas2js-with-generics-rocks-and-makes-castle-game-engine-for-webgl-possible/</a></p>
</li>
<li>
<p>Another option is to wait for FPC to support WebAssembly output. Or support LLVM output at level that it can be used with Emscripten to compile our code to asm.js.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Finishing the job on our (engine) side should be easy. WebGL API is like OpenGL ES, and we already have it implemented perfectly:)  We want to explore this after CGE 7.0 release.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_do_we_install_a_single_plugin_handling_all_games_developed_using_cge_or_is_every_game_a_separate_plugin">2. Do we install a single plugin, handling all games developed using CGE, or is every game a separate plugin?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Depends on the game.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>If your game is a VRML/X3D world (with possible scripting)</strong>, then users need only to install a "view3dscene plugin" to run it  on a web. view3dscene is our VRML/X3D browser (and a viewer for many other 3D and 2D formats). See <a href="http://castle-engine.sourceforge.net/view3dscene.php" class="bare">http://castle-engine.sourceforge.net/view3dscene.php</a> . This plugin will be able to run any VRML/X3D world.</p>
</li>
<li>
<p>But <strong>if your game has logic implemented in Object Pascal</strong>, then your game is a new plugin that must be installed by the user.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Unlike Flash (or Unity WebPlayer or Java Applets), we don&#8217;t have a sandbox to run Object Pascal. So if you write Object Pascal code, it&#8217;s compiled to a new plugin, and users need to install it. In theory, we could create a "Castle Game Engne plugin" that can dynamically link with your game code (thus creating a CGE plugin architecture within an NPAPI plugin:), but that would be very bad from a security point of view.</p>
</div>
<div class="paragraph">
<p>I hope that it will not be a huge problem. I&#8217;m looking at Unity here, where "Unity WebPlayer" is not something universal, and yet people install it to play games. So hopefully plugins using CGE will be able to live too:)</p>
</div>
</div>
</div>