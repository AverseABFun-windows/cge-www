<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#_compilation_errors_trying_to_use_a_unit_which_was_compiled_with_a_different_fpu_mode">Compilation errors "Trying to use a unit which was compiled with a different FPU mode"</a></li>
<li><a href="#_libz_errors_exception_in_thread_png_cruncher_errors">libz errors, "exception in thread png-cruncher" errors</a></li>
<li><a href="#_clang_errors">clang errors</a></li>
<li><a href="#_could_not_find_tools_jar_error">"Could not find tools.jar" error</a></li>
<li><a href="#_errors_when_executing_aidl_on_64_bit_x86_64_linux">Errors when executing aidl on 64-bit (x86_64) Linux</a></li>
<li><a href="#_error_no_toolchains_found_in_the_ndk_toolchains_folder_for_abi_with_prefix_mipsel_linux_android">Error "No toolchains found in the NDK toolchains folder for ABI with prefix: mipsel-linux-android"</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Some things that can go wrong with Android SDK / NDK:</p>
</div>
<div class="paragraph">
<p>Table of Contents:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#compilation-errors-trying-to-use-a-unit-which-was-compiled-with-a-different-fpu-mode">Compilation errors "Trying to use a unit which was compiled with a different FPU mode"</a></p>
</li>
<li>
<p><a href="#libz-errors-exception-in-thread-png-cruncher-errors">libz errors, "exception in thread png-cruncher" errors</a></p>
</li>
<li>
<p><a href="#clang-errors">clang errors</a></p>
</li>
<li>
<p><a href="#could-not-find-toolsjar-error">"Could not find tools.jar" error</a></p>
</li>
<li>
<p><a href="#errors-when-executing-aidl-on-64-bit-x86_64-linux">Errors when executing aidl on 64-bit (x86_64) Linux</a></p>
</li>
<li>
<p><a href="#error-no-toolchains-found-in-the-ndk-toolchains-folder-for-abi-with-prefix-mipsel-linux-android">Error "No toolchains found in the NDK toolchains folder for ABI with prefix: mipsel-linux-android"</a></p>
</li>
</ul>
</div>
</div>
</div>
<h1 id="_compilation_errors_trying_to_use_a_unit_which_was_compiled_with_a_different_fpu_mode" class="sect0">Compilation errors "Trying to use a unit which was compiled with a different FPU mode"</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>This indicates you compiled FPC standard units without <code>-CfVFPV3</code>. This would result in very slow execution on Android. Solutions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you compile FPC cross-compiler yourself, following <a href="Android" class="bare">Android</a>, remember to add <code>CROSSOPT="-CfVFPV3"</code> .</p>
</li>
<li>
<p>If you compile FPC cross-compiler by <a href="fpcupdeluxe" class="bare">fpcupdeluxe</a>, go to the "Setup+" options and for Android/Arm add <code>-CfVFPV3</code> option.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="https://castle-engine.io/images/original_size/fpcupdeluxe-hard-floats.png" alt="FpcUpDeluxe cross-compiler options">
</div>
</div>
</div>
</div>
<h1 id="_libz_errors_exception_in_thread_png_cruncher_errors" class="sect0">libz errors, "exception in thread png-cruncher" errors</h1>
<div class="openblock partintro">
<div class="content">
In case of errors about <code>libz.so.1</code> (resulting in later errors about <em>Exception in thread "png-cruncher&#8230;&#8203;</em>) on Linux 64-bit, see here: <a href="http://stackoverflow.com/questions/29241640/error-unable-to-run-mksdcard-sdk-tool" class="bare">http://stackoverflow.com/questions/29241640/error-unable-to-run-mksdcard-sdk-tool</a> . Install additional libraries as needed.
</div>
</div>
<h1 id="_clang_errors" class="sect0">clang errors</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>The Android NDK for 32-bit Windows has a known error in version r12b, see <a href="https://github.com/android-ndk/ndk/issues/139" class="bare">https://github.com/android-ndk/ndk/issues/139</a> . The clang binaries are for 64-bit architecture. It will prevent compiling the NDK samples (not related to CGE&#8230;&#8203;). This should be fixed in next NDK release. An easy fix for now is to go to "ndk\toolchains\llvm\prebuilt\windows\bin" directory and:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>rename clang.exe -&gt; clang_64.exe (or just remove it)</p>
</li>
<li>
<p>rename clang_32.exe -&gt; clang.exe</p>
</li>
<li>
<p>rename clang&#43;&#43;.exe -&gt; clang&#43;&#43;_64.exe (or just remove it)</p>
</li>
<li>
<p>copy clang.exe -&gt; clang&#43;&#43;.exe (yes, just copy to a new name, this is the same executable).</p>
</li>
</ul>
</div>
</div>
</div>
<h1 id="_could_not_find_tools_jar_error" class="sect0">"Could not find tools.jar" error</h1>
<div class="openblock partintro">
<div class="content">
The error <em>Could not find tools.jar</em> usually means you did not set JAVA_HOME correctly (to point to JDK).
</div>
</div>
<h1 id="_errors_when_executing_aidl_on_64_bit_x86_64_linux" class="sect0">Errors when executing aidl on 64-bit (x86_64) Linux</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>If you get errors when executing <code>/usr/local/android/android-sdk-linux/build-tools/23.0.2/aidl</code> on 64-bit (x86_64) Linux:</p>
</div>
<div class="paragraph">
<p>That is because Google distributes them as compiled for a 32-bit (i386) Linux system. Install some additional libraries to make them work. On Debian:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>apt-get install libc6-i386 lib32stdc++6 lib32z1</pre>
</div>
</div>
<div class="paragraph">
<p>(In general, old build-tools are distributed only for Linux 32-bit, and new build-tools are distributed only for Linux 64-bit. Google doesn&#8217;t provide alternatives for both architectures here.) See <a href="https://stackoverflow.com/questions/24158727/android-sdk-aapt-error-libstdc-so-6-cannot-open-shared-object-file" class="bare">https://stackoverflow.com/questions/24158727/android-sdk-aapt-error-libstdc-so-6-cannot-open-shared-object-file</a> .</p>
</div>
</div>
</div>
<h1 id="_error_no_toolchains_found_in_the_ndk_toolchains_folder_for_abi_with_prefix_mipsel_linux_android" class="sect0">Error "No toolchains found in the NDK toolchains folder for ABI with prefix: mipsel-linux-android"</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>This error occurs since Android NDK 18. They removed MIPS CPU support (which we never used), but old Gradle versions still expect to find the relevant folders.</p>
</div>
<div class="paragraph">
<p>A workaround is to create the necessary folders manually (it&#8217;s OK to leave them empty), by running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>mkdir -p $ANDROID_NDK_HOME/toolchains/mipsel-linux-android-4.9/prebuilt/linux-x86_64
mkdir -p $ANDROID_NDK_HOME/toolchains/mips64el-linux-android-4.9/prebuilt/linux-x86_64</pre>
</div>
</div>
<div class="paragraph">
<p>This problem should no longer be present (we upgraded Gradle in CGE). See also</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/castle-engine/castle-engine/issues/105" class="bare">https://github.com/castle-engine/castle-engine/issues/105</a></p>
</li>
<li>
<p><a href="https://github.com/google/filament/issues/15" class="bare">https://github.com/google/filament/issues/15</a></p>
</li>
</ul>
</div>
</div>
</div>