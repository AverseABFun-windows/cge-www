<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_what_is_the_equivalent_of_unity_gameobject">1. What is the equivalent of Unity <code>GameObject</code>?</a></li>
<li><a href="#_how_to_design_a_level_composed_from_multiple_assets_creatures_etc">2. How to design a level composed from multiple assets, creatures etc.?</a></li>
<li><a href="#_where_to_place_code_for_specific_actors_like_creatures_items_what_is_the_equivalent_of_adding_a_monobehaviour_to_a_gameobject_in_unity">3. Where to place code for specific actors (like creatures, items)? What is the equivalent of "adding a MonoBehaviour to a GameObject" in Unity?</a></li>
<li><a href="#_what_is_the_equivalent_of_unity_assets_subdirectory">4. What is the equivalent of Unity <code>Assets</code> subdirectory?</a></li>
<li><a href="#_what_model_formats_are_supported">5. What model formats are supported?</a></li>
<li><a href="#_do_you_support_fbx_model_format">6. Do you support FBX model format?</a></li>
<li><a href="#_why_does_editor_template_3d_fps_game_show_a_different_approach_than_examplesfps_game">7. Why does editor template "3D FPS Game" show a different approach than <code>examples/fps_game</code>?</a></li>
<li><a href="#_should_i_use_tcastlewindowbase_or_tcastlecontrolbase">8. Should I use TCastleWindowBase or TCastleControlBase?</a></li>
<li><a href="#_where_is_time_timescale">9. Where is <code>Time.timeScale</code>?</a></li>
<li><a href="#_where_is_time_deltatime">10. Where is <code>Time.deltaTime</code>?</a></li>
<li><a href="#_making_components_inactive">11. Making components inactive</a></li>
<li><a href="#_user_interface_scaling">12. User interface scaling</a></li>
<li><a href="#_unity_services">13. Unity Services</a></li>
<li><a href="#_shaders">14. Shaders</a></li>
<li><a href="#_viewports">15. Viewports</a></li>
<li><a href="#_prefabs">16. Prefabs</a></li>
<li><a href="#_playing_sounds">17. Playing sounds</a></li>
<li><a href="#_what_is_the_difference_between_owner_and_parent_in_cge">18. What is the difference between <code>Owner</code> and <code>Parent</code> in CGE?</a></li>
</ul>
</div>
<div class="paragraph">
<p>If you come with a knowledge of another game engine, like <em>Unity</em>, this page will try to explain how some concepts map to <em>Castle Game Engine</em>. If you have any questions, remember to ask on <a href="https://forum.castle-engine.io/">forum</a>, <a href="https://castle-engine.io/talk.php">Discord chat or other places</a>.</p>
</div>
<div class="paragraph">
<p>Table of Contents:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#what-is-the-equivalent-of-unity-gameobject">What is the equivalent of Unity GameObject?</a></p>
</li>
<li>
<p><a href="#how-to-design-a-level-composed-from-multiple-assets-creatures-etc">How to design a level composed from multiple assets, creatures etc.?</a></p>
</li>
<li>
<p><a href="#where-to-place-code-for-specific-actors-like-creatures-items-what-is-the-equivalent-of-adding-a-monobehaviour-to-a-gameobject-in-unity">Where to place code for specific actors (like creatures, items)? What is the equivalent of "adding a MonoBehaviour to a GameObject" in Unity?</a></p>
</li>
<li>
<p><a href="#what-is-the-equivalent-of-unity-assets-subdirectory">What is the equivalent of Unity Assets subdirectory?</a></p>
</li>
<li>
<p><a href="#what-model-formats-are-supported">What model formats are supported?</a></p>
</li>
<li>
<p><a href="#do-you-support-fbx-model-format">Do you support FBX model format?</a></p>
</li>
<li>
<p><a href="#why-does-editor-template-3d-fps-game-show-a-different-approach-than-examplesfps_game">Why does editor template "3D FPS Game" show a different approach than examples/fps_game?</a></p>
</li>
<li>
<p><a href="#should-i-use-tcastlewindowbase-or-tcastlecontrolbase">Should I use TCastleWindowBase or TCastleControlBase?</a></p>
</li>
<li>
<p><a href="#where-is-timetimescale">Where is Time.timeScale?</a></p>
</li>
<li>
<p><a href="#where-is-timedeltatime">Where is Time.deltaTime?</a></p>
</li>
<li>
<p><a href="#making-components-inactive">Making components inactive</a></p>
</li>
<li>
<p><a href="#user-interface-scaling">User interface scaling</a></p>
</li>
<li>
<p><a href="#unity-services">Unity Services</a></p>
</li>
<li>
<p><a href="#shaders">Shaders</a></p>
</li>
<li>
<p><a href="#viewports">Viewports</a></p>
</li>
<li>
<p><a href="#prefabs">Prefabs</a></p>
</li>
<li>
<p><a href="#playing-sounds">Playing sounds</a></p>
</li>
<li>
<p><a href="#what-is-the-difference-between-owner-and-parent-in-cge">What is the difference between <code>Owner</code> and <code>Parent</code> in CGE?</a></p>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="_what_is_the_equivalent_of_unity_gameobject">1. What is the equivalent of Unity <code>GameObject</code>?</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>GameObject</code> in Unity is (simplifying) something that exists in your world, and may be visible, and may have children that are affected by a transformation.</p>
</div>
<div class="paragraph">
<p>For game objects (not user-interface), the closest equivalent of <code>GameObject</code> in <em>Castle Game Engine</em> is the <a href="https://castle-engine.io/apidoc-unstable/html/CastleTransform.TCastleTransform.html">TCastleTransform</a> class. Instances of <code>TCastleTransform</code> can be arranged in a hierarchy, where each element transforms (moves, rotates, scales) the children. The most important class of CGE is the <code>TCastleScene</code>, which is a descendant of <code>TCastleTransform</code> that can actually render/animate/collide a model. Simply set <code>TCastleScene.Url</code> to load your model (like a glTF file) there.</p>
</div>
<div class="paragraph">
<p>Our manual documents <code>TCastleScene</code> and <code>TCastleTransform</code> features: <a href="https://castle-engine.io/manual_load_3d.php" class="bare">https://castle-engine.io/manual_load_3d.php</a> , <a href="https://castle-engine.io/manual_scene.php" class="bare">https://castle-engine.io/manual_scene.php</a> . Basically you can do stuff like</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal">MyScene.Url := <span class="string"><span class="delimiter">'</span><span class="content">castle-data:/my_model.gltf</span><span class="delimiter">'</span></span>;
MyScene.Translation := Vector3(<span class="integer">1</span>, <span class="integer">2</span>, <span class="integer">3</span>);
MyScene.PlayAnimation(<span class="string"><span class="delimiter">'</span><span class="content">run</span><span class="delimiter">'</span></span>, true);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>TCastleTransform</code> hierarchy is placed in a <code>TCastleViewport</code>, which is a 2D user-interface element (descendant of <code>TCastleUserInterface</code>).</p>
</div>
<div class="paragraph">
<p>For objects that are user-interface elements, the most important base class is <code>TCastleUserInterface</code>. It has many descendants, like</p>
</div>
<div class="ulist">
<ul>
<li>
<p>obvious user interface controls: <code>TCastleButton</code>, <code>TCastleLabel</code>, <code>TCastleRectangleControl</code>, <code>TCastleImageControl</code>&#8230;&#8203;</p>
</li>
<li>
<p>layouts: <code>TCastleVerticalGroup</code>, <code>TCastleHorizontalGroup</code>,</p>
</li>
<li>
<p>and finally a critical UI component <code>TCastleViewport</code> which is a "gateway" to actually render a hierarchy of <code>TCastleTransform</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See <a href="https://castle-engine.io/manual_2d_user_interface.php" class="bare">https://castle-engine.io/manual_2d_user_interface.php</a> about 2D user interface.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_design_a_level_composed_from_multiple_assets_creatures_etc">2. How to design a level composed from multiple assets, creatures etc.?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the simplest case, for each 3D model, you create a <code>TCastleScene</code> instance. You can do this visually, using the <a href="https://castle-engine.io/manual_editor.php">CGE editor</a>, or from code.</p>
</div>
<div class="paragraph">
<p>To group (and transform as a group) a number of <code>TCastleScene</code> instances you can use additional <code>TCastleTransform</code> instances. The <code>TCastleScene</code> is also a <code>TCastleTransform</code> descendant, so it can have children too.</p>
</div>
<div class="paragraph">
<p>Follow the template <em>"3D FPS Game"</em> (create it by running our editor, choose <em>"New Project"</em> and then choose <em>"3D FPS Game"</em> as a starting point). In the resulting project, open the design <code>data/state_play.castle-user-interface</code> in the editor, to actually see what I mean (in this and previous answer).</p>
</div>
<div class="paragraph">
<p>Our goal with <a href="https://castle-engine.io/manual_editor.php">CGE editor</a> is to provide an experience similar to Unity and other game engine editors. So you can drop 3D models on your design, and drag them to design a level. Yes, it&#8217;s a work in progress&#8201;&#8212;&#8201;but we&#8217;ll get there, believe me :) Look how many <a href="https://castle-engine.io/features.php">big features we managed to make already</a> :)</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_where_to_place_code_for_specific_actors_like_creatures_items_what_is_the_equivalent_of_adding_a_monobehaviour_to_a_gameobject_in_unity">3. Where to place code for specific actors (like creatures, items)? What is the equivalent of "adding a MonoBehaviour to a GameObject" in Unity?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are multiple ways how you can control CGE stuff:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The equivalent of <code>MonoBehaviour</code> is <code>TCastleBehavior</code> class. So you can <strong>define a class descending from <code>TCastleBehavior</code>, and add an instance of it to <code>TCastleTransform</code></strong>. Like</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal">  <span class="keyword">type</span>
    TMyBehaviorClass = <span class="keyword">class</span>(TCastleBehavior)
    <span class="directive">public</span>
      <span class="keyword">procedure</span> Update(<span class="keyword">const</span> SecondsPassed: Single; <span class="keyword">var</span> RemoveMe: TRemoveType); <span class="directive">override</span>;
    <span class="keyword">end</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then add such behavior instance from code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal">  <span class="keyword">var</span>
    MyBehavior: TMyBehaviorClass;
  <span class="keyword">begin</span>
    MyBehavior := TMyBehaviorClass.Create(SomOwner);
    MyBehavior.Xxx := ...; <span class="comment">// configure necessary parameters</span>
    MyTransform.AddBehavior(MyBehavior);
  <span class="keyword">end</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>See our template <em>"3D FPS Game"</em> (create it by running our editor, choose <em>"New Project"</em> and then choose <em>"3D FPS Game"</em> as a starting point) that shows exactly this approach. It defines a trivial <code>TEnemy</code> class that defines the logic of an enemy, and is a <code>TCastleBehavior</code> descendant. It controls the enemy movement. It also allows to check (e.g. when shooting ray) "did I hit an enemy" by checking <code>SomeTransform.FindBehavior(TEnemy) &lt;&gt; nil</code>.</p>
</div>
<div class="paragraph">
<p>While the above examples show attaching a behavior using code, you could also add <code>TEnemy</code> in editor, if you <a href="https://github.com/castle-engine/castle-engine/blob/master/tools/castle-editor/README.md#include-custom-project-specific-components-in-the-visual-designer">register it with the editor</a>. This requires to restart editor within the project with menu option <em>"Project -&gt; Restart Editor (With Custom Components)"</em> first&#8201;&#8212;&#8201;although admittedly it&#8217;s a bit cumbersome, so for your game-specific behaviors in simple cases you may find it more straightforward we to just add them by code.</p>
</div>
<div class="paragraph">
<p>The engine comes with a few standard behaviors too (like <a href="https://castle-engine.io/apidoc-unstable/html/CastleBehaviors.TCastleBillboard.html">TCastleBillboard</a>, <a href="https://castle-engine.io/apidoc-unstable/html/CastleBehaviors.TCastleSoundSource.html">TCastleSoundSource</a>) and these are comfortable to add and configure from the editor.</p>
</div>
</li>
<li>
<p>Another way to control things in CGE is to <strong>create class descendants from existing classes</strong>. In CGE you can create descendants from almost all classes (including important <code>TCastleTransform</code> and <code>TCastleUserInterface</code>), and override virtual methods there. E.g. you can override <code>TCastleTransform.Update</code> to perform something every frame.</p>
<div class="paragraph">
<p>So you could <strong>define a class like <code>TMyCreature</code></strong> that descends from <code>TCastleTransform</code> or <code>TCastleScene</code>. This class would control it&#8217;s own transformation (e.g. it would change it&#8217;s own <code>Translation</code> to move the creature) and it would possibly load some children (more <code>TCastleTransform</code> and <code>TCastleScene</code> instances) to show and animate the creature.</p>
</div>
<div class="paragraph">
<p>This is a classic OOP approach. This is like <em>Unreal Engine</em> that allows you to define your own actor classes that override the base class.</p>
</div>
<div class="paragraph">
<p>You can even <a href="https://github.com/castle-engine/castle-engine/blob/master/tools/castle-editor/README.md#include-custom-project-specific-components-in-the-visual-designer">register your custom classes to be available in the editor, to add/configure them visually</a>.</p>
</div>
</li>
<li>
<p>You can also <strong>assign events, like <code>OnPress</code></strong>. Most UI controls expose obvious events, like <code>TCastleButton.OnClick</code>. You are free to handle these events at one central place (like an LCL <code>TForm</code> descendant (only if you use <code>TCastleControlBase</code>), or CGE <code>TUIState</code> descendant) or decentralized (e.g. create a different instance of your own class to handle events of each different creature, different item).</p>
<div class="paragraph">
<p>The approach to use events is similar to using UI in Lazarus LCL or Delphi VCL.</p>
</div>
</li>
<li>
<p>You can also <strong>control things from outside, e.g. control all creatures from the state instance</strong>. The state like <code>TStatePlay</code> (see above mentioned template <em>"3D FPS Game"</em>) has its own methods to <code>Update</code> and handle input. The state can keep references to everything you have in your world, and it can control them.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_what_is_the_equivalent_of_unity_assets_subdirectory">4. What is the equivalent of Unity <code>Assets</code> subdirectory?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You should place your game data in the <code>data</code> subdirectory of the project. See <a href="https://castle-engine.io/manual_data_directory.php">manual about the "data" directory</a>. It will be automatically packaged and available in your games.</p>
</div>
<div class="paragraph">
<p>Everything inside your <code>data</code> subdirectory is loadable at runtime. In this sense, it is actually similar to <code>Assets/Resources/</code> subdirectory of Unity, if you care about details.</p>
</div>
<div class="paragraph">
<p>Things that are not your game data (like your source code) should <em>not</em> be placed in the <code>data</code> subdirectory. The source code should live outside of data. Only the compiler must be able to find it (you can specify your sources locations using standard Lazarus <em>Project Options</em> and/or (for building cross-platform projects) using <a href="https://github.com/castle-engine/castle-engine/wiki/CastleEngineManifest.xml-examples"><code>&lt;compiler_options&gt;</code> in CastleEngineManifest.xml</a>). By convention, most CGE examples place Pascal source code in the <code>code</code> subdirectory (or in top-level project directory), but this is really only a convention.</p>
</div>
<div class="paragraph">
<p>The layout of a larger CGE project may be like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>my_project/
  CastleEngineManifest.xml     &lt;- the project root; manifest XML file is used by CGE build tool and CGE editor
  data/                        &lt;- game data lives here; up to you how to organize this
    CastleSettings.xml         &lt;- defines UI scaling, default font
    example_image.png
    example_model.gltf
    state_main_menu.castle-user-interface
    ...
  code/                        &lt;- Pascal game code lives here; up to you how to organize this
    gameinitialize.pas
    gamestatemainmenu.pas
    ...
  ...                          &lt;- any other subdirectories and files? Up to you. Consider docs/ and README.md.</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_what_model_formats_are_supported">5. What model formats are supported?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>See <a href="https://castle-engine.io/creating_data_model_formats.php">supported model formats</a>. In short: glTF is the best :) This documentation page also links to instructions for various authoring tools "how to export your data".</p>
</div>
<div class="paragraph">
<p>Test your models with <a href="https://castle-engine.io/view3dscene.php">view3dscene</a> to see what is supported. If you double-click on a model from <a href="https://castle-engine.io/manual_editor.php">CGE editor</a>, it will automatically launch view3dscene.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_do_you_support_fbx_model_format">6. Do you support FBX model format?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>No, and we will probably never do (unless indirectly through some universal conversion library). FBX is a proprietary model format by Autodesk. Please don&#8217;t use FBX, it&#8217;s proprietary (the Autodesk specification of FBX is "secret" deliberately, and Autodesk only sanctions using FBX through it&#8217;s paid SDK), and also not that good. Use glTF.</p>
</div>
<div class="paragraph">
<p>If you have existing models in FBX format you can <a href="https://github.com/facebookincubator/FBX2glTF">convert them to glTF</a>. If you have the source versions of your models, possibly you can just reexport them from <a href="https://castle-engine.io/creating_data_export.php">your authoring software</a> to glTF. You can also use <a href="https://www.blender.org/">Blender</a> or a number of <a href="https://github.com/KhronosGroup/glTF-Generator-Registry/blob/master/dist/REGISTRY.md">other tools</a> to convert between model formats.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_does_editor_template_3d_fps_game_show_a_different_approach_than_examplesfps_game">7. Why does editor template "3D FPS Game" show a different approach than <code>examples/fps_game</code>?</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>TODO: We work on removing the inconsistency documented below, by introducing new, editor-friendly API for creature behaviors.</strong></p>
</div>
<div class="paragraph">
<p>The <code>examples/fps_game</code> example shows how to use our <a href="https://castle-engine.io/manual_3d_utlities_overview.php">Utilities for typical 3D games</a> that are included in <code>CastleCreatures</code>, <code>CastleItems</code> and friend units. It is an older example, not using CGE editor.</p>
</div>
<div class="paragraph">
<p>On one hand, the <code>examples/fps_game</code> approach gives you more things "out of the box" now. E.g. using this approach, you can trivially get a creature that knows how to travel in 3D space, how to approach an enemy to have a good position to shoot a missile or do a close-range attack. On the other hand, <code>examples/fps_game</code> approach doesn&#8217;t map nicely to CGE editor, and is not absolulety flexible (although it may be quite enough for a typical first-person shooter, and there are many ways to customize it&#8201;&#8212;&#8201;see subpages of <a href="https://castle-engine.io/manual_high_level_3d_classes.php" class="bare">https://castle-engine.io/manual_high_level_3d_classes.php</a> , and see TMedKitResource and TMedKit classes in <code>fps_game</code>).</p>
</div>
<div class="paragraph">
<p>So <code>examples/fps_game</code> and our template "3D FPS Game" present indeed a <strong>different</strong> approach to creating an FPS game. We know about it, and it is a TODO, of course we want to remove this discrepancy. The plan to do this is mentioned at the bottom of <a href="https://castle-engine.io/manual_3d_utlities_overview.php" class="bare">https://castle-engine.io/manual_3d_utlities_overview.php</a> and <a href="https://castle-engine.io/planned_features.php" class="bare">https://castle-engine.io/planned_features.php</a> . Basically our API from CastleCreatures will be adjusted to easily create a "ready" TEnemy with more intelligence out of the box. IOW, we will make the approach from template <em>"3D FPS Game"</em> more powerful, it will be trivial to create your own <code>TEnemy</code> that has advanced intelligence.</p>
</div>
<div class="paragraph">
<p>What to do right now:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you want to have flexibility, I would advice following <em>"3D FPS Game"</em> template idea, and create your own creature AI. This is the better approach long-term, and it is the approach which we will focus on (extending it in the future).</p>
</li>
<li>
<p>Only if you want to have something close to what <code>examples/fps_game</code> presents, i.e. a typical first-person shooter, then follow <code>examples/fps_game</code> approach.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_should_i_use_tcastlewindowbase_or_tcastlecontrolbase">8. Should I use TCastleWindowBase or TCastleControlBase?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A short summary of the answer: Use TCastleWindowBase. If all you want is a cross-platform game, where everything is rendered using Castle Game Engine. If you come here and want to "just make a game using CGE", use <code>TCastleWindowBase</code>.</p>
</div>
<div class="paragraph">
<p>Details: The difference is outlined on <a href="https://castle-engine.io/manual_lazarus_control.php" class="bare">https://castle-engine.io/manual_lazarus_control.php</a> :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>TCastleControlBase means that engine rendering is inside Lazarus form. That is, TCastleControlBase is a regular Lazarus control that can be placed on a larger form. You can use Lazarus designer to place LCL controls, and you can use CGE editor to design CGE controls (within TCastleControlBase).</p>
</li>
<li>
<p>TCastleWindowBase means that engine rendering is a separate window, and we&#8217;re not using LCL. You can use CGE editor to design controls. So you lose access to LCL controls, but in exchange you get perfect cross-platform code (Android, iOS, Switch only with with TCastleWindowBase).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In both cases, you can use Lazarus as an IDE&#8201;&#8212;&#8201;to write code, debug etc. In both cases, you can use CGE editor to design CGE controls (that go inside TCastleControlBase or TCastleWindowBase).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_where_is_time_timescale">9. Where is <code>Time.timeScale</code>?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An equivalent is to set <code>MyViewport.Items.TimeScale</code>.</p>
</div>
<div class="paragraph">
<p>It is specific to the given world, which is an instance of <code>TCastleAbstractRootTransform</code> available in <code>MyViewport.Items</code>. Simple games will just have one viewport, a <code>TCastleViewport</code> instance. Multiple instances of <code>TCastleViewport</code> are possible, and then can share the same world, or show a different world (just assign <code>Items</code> between).</p>
</div>
<div class="paragraph">
<p>There in an additional time scaling possible by <code>TCastleScene.TimePlayingSpeed</code>. This is local in given <code>TCastleScene</code> instance.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_where_is_time_deltatime">10. Where is <code>Time.deltaTime</code>?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In <code>Container.Fps.SecondsPassed</code>. See the <a href="https://castle-engine.io/manual_state_events.php" class="bare">https://castle-engine.io/manual_state_events.php</a> for the most trivial usage example.</p>
</div>
<div class="paragraph">
<p>In you override the <code>TCastleUserInterface.Update</code> (including <code>TUIState.Update</code>) or <code>TCastleTransform.Update</code> method, then you also have an explicit parameter <code>SecondsPassed</code> that contains this value. In <code>TCastleTransform.Update</code> the time is already scaled (if you used <code>MyViewport.Items.TimeScale</code> mentioned above).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_making_components_inactive">11. Making components inactive</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Both <code>TCastleTransform</code> and <code>TCastleUserInterface</code> have a Boolean <a href="https://castle-engine.io/apidoc-unstable/html/CastleTransform.TCastleTransform.html#Exists">Exists</a> property, by default <code>true</code>. Simply set it to <code>false</code> to make everything behave as if this component was <em>not</em> part of the hierarchy. Non-existing components are not visible, do not collide, do not handle any input, do not cause any events etc. So Unity <code>GameObject.SetActive(xxx)</code> translates to CGE <code>TCastleTransform.Exists := xxx</code>.</p>
</div>
<div class="paragraph">
<p>You can also override their <a href="https://castle-engine.io/apidoc-unstable/html/CastleTransform.TCastleTransform.html#GetExists">GetExists</a> methods. This is quite powerful sometimes, instead of imperatively <em>setting</em> the <code>Exists</code> property, you can <em>define a rule</em> in <code>GetExists</code> that determines object&#8217;s existence. It is evaluated every frame. By default the <code>GetExists</code> method just returns the <code>Exists</code> property value.</p>
</div>
<div class="paragraph">
<p>You can also control the <code>Collides</code> and <code>Pickable</code> and <code>Visible</code> properties of <code>TCastleTransform</code>. These are useful to make something e.g. visible but non-collidable, or collidable but invisible. Note that when <code>Exists</code> is <code>false</code>, it "overrides" them, and non-existing object never collides and is never visible.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_user_interface_scaling">12. User interface scaling</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We have UI scaling, to adjust to any screen size smartly, and it works similar to Unity 5 canvas scaling. It allows to design assuming a specific window size, and as long as you set sensible anchors, the design will look reasonable at various screen resolutions (even with different aspect ratio). It merely scales the coordinates&#8201;&#8212;&#8201;the actual rendering is done for the final resolution, so it looks "sharp" always.</p>
</div>
<div class="paragraph">
<p>The scaling is configured using <a href="https://castle-engine.io/manual_castle_settings.php">CastleSettings.xml</a> file. The default CGE editor "New Project" templates set UI scaling to adjust with a reference window size of 1600x900. See also <a href="https://castle-engine.sourceforge.io/manual_user_interface_and_2d_drawing.php">manual about user interface</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_unity_services">13. Unity Services</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Mobile services like ads, analytics, in-app purchases and more are available as <a href="https://github.com/castle-engine/castle-engine/wiki/Android-Services">Android services</a> or <a href="https://github.com/castle-engine/castle-engine/wiki/iOS-Services">iOS services</a>. You declare them in <a href="https://github.com/castle-engine/castle-engine/wiki/CastleEngineManifest.xml-examples">CastleEngineManifest.xml</a> and then build the project using our <a href="https://github.com/castle-engine/castle-engine/wiki/Build-Tool">build tool</a>. These allow to integrate your code with various 3rd-party services (from Google, Apple and others) or use mobile APIs that require special permissions (like vibrations).</p>
</div>
<div class="paragraph">
<p>The <em>"service"</em> means <em>"a part of the project, in binary or source code, added during the build stage"</em>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Android services may contain Java code, precompiled libraries for Android, Gragle configuration and more.</p>
</li>
<li>
<p>iOS services may contain Objective-C code, precompiled libraries for iOS, <a href="https://cocoapods.org/">CocoaPods</a> configuration and more.</p>
</li>
<li>
<p>On other platforms, so far we didn&#8217;t need a similar concept. E.g. integration of CGE with 3rd-party services on desktops is always possible by normal Pascal units that expose e.g. FMOD or Steam API. That said, it is possible that we will add "services" for other platforms some day.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_shaders">14. Shaders</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can of course replace or enhance the shaders used by our engine.</p>
</div>
<div class="paragraph">
<p>We have <a href="https://castle-engine.io/compositing_shaders.php">compositing shaders</a> which is like Unity3d "surface shaders" but on steroids :)  I&#8217;m quite proud of this, it really allows to easily write a piece of shader code and add it to some shapes, and (compared to Unity3d "surface shaders") it has some cool new features, like the ability to combine many effects (so you can write one shader effect, maybe add another shader effect), or changing shading of lights or textures or making proceduraly generated (on GPU) textures.</p>
</div>
<div class="paragraph">
<p>See <a href="https://github.com/castle-engine/castle-engine/tree/master/examples/3d_rendering_processing/shader_effects">examples/3d_rendering_processing/shader_effects</a> for simple demo in Pascal that attaches an effect, coded in GLSL, to a scene loaded from glTF. The shader uniform variable can be set at runtime from Pascal of course, and thus you can configure the shader at runtime with zero cost.</p>
</div>
<div class="paragraph">
<p>See <a href="https://github.com/castle-engine/demo-models" class="bare">https://github.com/castle-engine/demo-models</a>, subdirectory <a href="https://github.com/castle-engine/demo-models/tree/master/compositing_shaders">compositing_shaders</a> for demos of <code>Effect</code> nodes in pure X3D (you can load them all from CGE; it&#8217;s just that these demos create <code>Effect</code> node by X3D code, not by Pascal code).</p>
</div>
<div class="paragraph">
<p>The <a href="https://castle-engine.io/compositing_shaders.php">compositing shaders documentation</a>, in particular <a href="https://castle-engine.io/compositing_shaders_doc/html/">this document</a>, describe how these shader effects work.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_viewports">15. Viewports</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Unity, your typical world is a hierarchy of 3D <code>GameObject</code>s.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Somewhere in this world, you have a <code>Camera</code> component, that determines the camera parameters (like projection) and viewport sizes. The transformation of the associated <code>GameObject</code> determines the camera position and rotation.</p>
</li>
<li>
<p>You can have multiple <code>Camera</code> components on different GameObjects to have multiple viewports.</p>
</li>
<li>
<p>Somewhere in this world, you have a canvas that acts as a place for 2D controls like buttons and images.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In CGE, it is a bit different. Viewport (<code>TCastleViewport</code>) is a 2D control, and it can render 3D world inside.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You design a hierarchy of <code>TCastleUserInterface</code> components. They all have the same properties to control position and size, using anchors, using <code>FullSize</code> (fill the parent etc.).</p>
</li>
<li>
<p>There are numerous <code>TCastleUserInterface</code> descendants, like buttons, images, and viewports.</p>
</li>
<li>
<p>Within a viewport (<code>TCastleViewport</code>) instance, you place your 3D world (in <code>Viewport.Items</code>).</p>
</li>
<li>
<p>A viewport is always connected with exactly one camera in <code>Viewport.Camera</code>. This camera determines projection settings and position, rotation of the viewer.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The above describes the typical design as seen in editor templates. To see it in action, create a <em>"New Project"</em> in the editor, using the template like <em>"3D FPS Game"</em>, and open the design <code>data/state_play.castle-user-interface</code> in the editor.</p>
</div>
<div class="paragraph">
<p>In short, in Unity "viewport" and "camera" and "UI" are just things inside your 3D world. In CGE, "viewport" (and the corresponding "camera") contains your 3D world, and "viewport" is part of your UI.</p>
</div>
<div class="paragraph">
<p>In effect,</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In CGE the "viewport" can be positioned/sized just like any other 2D control. See <code>examples/3d_rendering_processing/multiple_viewports.lpr</code> for an example that shows 4 viewports.</p>
</li>
<li>
<p>The Z-order (what is in front/behind) of the viewport in CGE is straightforward, it works just like all other 2D controls. You can easily place other 2D controls in front or behind a viewport (the latter is useful if the viewport has <code>Transparent</code> background).</p>
</li>
<li>
<p>In CGE each "viewport" may show a completely different, unrelated, 3D world. The viewports can also share the world (show the same world from different cameras), simply set them the same <code>Viewport.Items</code> value.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_prefabs">16. Prefabs</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>Prefabs</em> are a way to store <em>GameObject</em> hierarchy, with Unity components attached, in a file.</p>
</div>
<div class="paragraph">
<p>The usual equivalent in CGE is to create a <code>xxx.castle-transform</code> file where you create a design with a root being <code>TCastleTransform</code> or <code>TCastleScene</code>. This allows you to compose a transformation hierarchy of <code>TCastleTransform</code> / <code>TCastleScene</code> instances. You can then load this <code>xxx.castle-transform</code> multiple times, as a single thing. See the <a href="https://github.com/castle-engine/castle-engine/tree/master/examples/advanced_editor">examples/advanced_editor</a>, the file <code>data/soldier_with_cape.castle-transform</code> there is a simplest example of this approach.</p>
</div>
<div class="paragraph">
<p>The equivalent of prefabs for Unity UI elements is a UI design file, <code>xxx.castle-user-interface</code>, already mentioned above.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_playing_sounds">17. Playing sounds</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The equivalent of Unity <a href="https://docs.unity3d.com/Manual/class-AudioSource.html">AudioSource</a> is our <a href="https://castle-engine.io/apidoc-unstable/html/CastleBehaviors.TCastleSoundSource.html">TCastleSoundSource</a>. It is a behavior, you attach it to a parent <code>TCastleTransform</code> and it can play spatialized sound. Note that for non-spatial sounds, you can also just call <a href="https://castle-engine.io/apidoc-unstable/html/CastleSoundEngine.TSoundEngine.html#Play">SoundEngine.Play</a>, this is simpler and there&#8217;s no need for a <code>TCastleSoundSource</code> instances.</p>
</div>
<div class="paragraph">
<p>The equivalent of Unity <a href="https://docs.unity3d.com/Manual/class-AudioClip.html">AudioClip</a> is our <a href="https://castle-engine.io/apidoc-unstable/html/CastleSoundEngine.TCastleSound.html">TCastleSound</a>.</p>
</div>
<div class="paragraph">
<p>See <a href="https://castle-engine.io/manual_sound.php">manual chapter about sound</a> for information how to use sound in CGE.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_what_is_the_difference_between_owner_and_parent_in_cge">18. What is the difference between <code>Owner</code> and <code>Parent</code> in CGE?</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><code>Owner</code> comes from from the standard <code>TComponent</code>. See <a href="https://castle-engine.io/modern_pascal_introduction.html#_manual_and_automatic_freeing" class="bare">https://castle-engine.io/modern_pascal_introduction.html#_manual_and_automatic_freeing</a> . It manages memory (owner will free the owned instance, when the owner is freed before the owned).</p>
</li>
<li>
<p><code>Parent</code> is a visual parent. CGE  UI has <code>TCastleUserInterface.Parent</code>. CGE transformatons have <code>TCastleTransform.UniqueParent</code> (a more complicated name to signal that sometimes, <code>TCastleTransform</code> has multiple parents, see <a href="https://castle-engine.io/manual_scene.php#section_many_instances" class="bare">https://castle-engine.io/manual_scene.php#section_many_instances</a> ).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>So <code>Parent</code> and <code>Owner</code> are separate concepts, declared in different classes. They may be set to the same object instance, if it is suitable in the particular situation, but these 2 things just perform 2 separate functions. In CGE editor, owner of everything in the design is always one central <code>DesignOwner</code> component. When you load the design yourself, you provide the <code>Owner</code> instance explicitly (as a parameter to <code>UserInterfaceLoad</code>, <code>TransformLoad</code>, <code>ComponentLoad</code>) and then you specify parent yourself but adding the design to the hierarchy (e.g. <code>MyStart.InsertFront(MyRootUi)</code>).</p>
</div>
</div>
</div>