<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#_table_of_contents">Table of Contents</a></li>
<li><a href="#_unit_groups">Unit groups</a>
<ul class="sectlevel1">
<li><a href="#_castle_base_package">1. castle_base package</a>
<ul class="sectlevel2">
<li><a href="#_base">1.1. base</a></li>
<li><a href="#_files">1.2. files</a></li>
<li><a href="#_audio">1.3. audio</a></li>
<li><a href="#_images">1.4. images</a></li>
<li><a href="#_fonts">1.5. fonts</a></li>
<li><a href="#_ui">1.6. ui</a></li>
<li><a href="#_services">1.7. services</a></li>
<li><a href="#_3d">1.8. 3d</a></li>
<li><a href="#_castlescript">1.9. castlescript</a></li>
<li><a href="#_x3d">1.10. x3d</a></li>
<li><a href="#_game">1.11. game</a></li>
</ul>
</li>
<li><a href="#_castle_window_package">2. castle_window package</a>
<ul class="sectlevel2">
<li><a href="#_window">2.1. window</a></li>
</ul>
</li>
<li><a href="#_castle_components_package">3. castle_components package</a>
<ul class="sectlevel2">
<li><a href="#_components">3.1. components</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_opengl_units">OpenGL units</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><em>Castle Game Engine</em> includes a <em>lot</em> of units. They are divided into a couple of groups, which you can see as subdirectories in the engine <code>src</code> subdirectory: <code>3d</code>, <code>audio</code> and so on. The groups are shortly described below.</p>
</div>
<div class="paragraph">
<p>One of the ways how we keep the engine architecture maintainable is to strictly limit the dependencies between unit groups. For example, the 3D or UI stuff depends on images, but the units in the <code>images</code> group cannot depend on units in the <code>3d</code> or <code>ui</code> groups. A strict dependency tree allows to easily debug some hard problems (when you want to strip the used units, to get to the "bottom of the problem").</p>
</div>
<div class="paragraph">
<p>We list the dependencies below. <strong>They can be automatically checked</strong> (the tool for this can be found in <code>scripts/check_units_dependencies/</code> in <a href="https://github.com/castle-engine/cge-scripts" class="bare">https://github.com/castle-engine/cge-scripts</a> ).</p>
</div>
<div class="paragraph">
<p><strong>TODO</strong>: Due to the need to support some deprecated methods, right now <code>CastleCameras</code> depends on <code>CastleSceneManager</code>, which breaks the dependencies outlined below, making <code>3d</code> and <code>game</code> inter-dependent. This is an exception, and otherwise we should still follow these dependencies, and this exception will be fixed in future releases.</p>
</div>
</div>
</div>
<h1 id="_table_of_contents" class="sect0">Table of Contents</h1>
<div class="openblock partintro">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><a href="#unit-groups">Unit groups</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="#castle_base-package">castle_base package</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="#base">base</a></p>
</li>
<li>
<p><a href="#files">files</a></p>
</li>
<li>
<p><a href="#audio">audio</a></p>
</li>
<li>
<p><a href="#images">images</a></p>
</li>
<li>
<p><a href="#fonts">fonts</a></p>
</li>
<li>
<p><a href="#ui">ui</a></p>
</li>
<li>
<p><a href="#services">services</a></p>
</li>
<li>
<p><a href="#3d">3d</a></p>
</li>
<li>
<p><a href="#castlescript">castlescript</a></p>
</li>
<li>
<p><a href="#x3d">x3d</a></p>
</li>
<li>
<p><a href="#game">game</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="#castle_window-package">castle_window package</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="#window">window</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="#castle_components-package">castle_components package</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="#components">components</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><a href="#opengl-units">OpenGL units</a></p>
</li>
</ul>
</div>
</div>
</div>
<h1 id="_unit_groups" class="sect0">Unit groups</h1>
<div class="sect1">
<h2 id="_castle_base_package">1. castle_base package</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_base">1.1. base</h3>
<div class="paragraph">
<p>Basic utilities and classes. Stuff for dealing with vectors, colors, strings, Unicode, logging, rectangles&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p><em>Depends on</em>: nothing else.</p>
</div>
</div>
<div class="sect2">
<h3 id="_files">1.2. files</h3>
<div class="paragraph">
<p>Files and XML utilities. Also downloading from the network, and processing of URLs. See <a href="http://castle-engine.sourceforge.net/tutorial_network.php">tutorial about network and downloading</a>.</p>
</div>
<div class="paragraph">
<p><em>Depends on</em>: everything above (that is, units in "base" group).</p>
</div>
</div>
<div class="sect2">
<h3 id="_audio">1.3. audio</h3>
<div class="paragraph">
<p>Sound files loading, sound playback (including 3D sound) using OpenAL, processing of sound files. See <a href="http://castle-engine.sourceforge.net/tutorial_sound.php">tutorial about sound</a>.</p>
</div>
<div class="paragraph">
<p><em>Depends on</em>: everything above (that is, units in "base" and "files" groups).</p>
</div>
</div>
<div class="sect2">
<h3 id="_images">1.4. images</h3>
<div class="paragraph">
<p>Images, textures, videos&#8201;&#8212;&#8201;loading, saving, displaying, processing in many ways.</p>
</div>
<div class="paragraph">
<p><em>Depends on</em>: everything above except audio.</p>
</div>
</div>
<div class="sect2">
<h3 id="_fonts">1.5. fonts</h3>
<div class="paragraph">
<p>Loading font data from files using FreeType, rendering text, converting font data to be embeddable as Pascal units.</p>
</div>
<div class="paragraph">
<p><em>Depends on</em>: everything above except audio.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ui">1.6. ui</h3>
<div class="paragraph">
<p>2D user interface of the engine. TUIControl class with descendants, like buttons, panels, on-screen menus&#8230;&#8203; Also keyboard, mouse and other input handling.</p>
</div>
<div class="paragraph">
<p><em>Depends on</em>: everything above.</p>
</div>
</div>
<div class="sect2">
<h3 id="_services">1.7. services</h3>
<div class="paragraph">
<p>Integration with environment (operating system). Opening a document, making a mobile payment, sending analytics data&#8230;&#8203; Note that the unit <code>CastleMessaging</code>, important for Android services, is inside the <code>base</code> group, not here (since nearly everything else can use it, e.g. sound engine needs to use it).</p>
</div>
<div class="paragraph">
<p><em>Depends on</em>: everything above.</p>
</div>
</div>
<div class="sect2">
<h3 id="_3d">1.8. 3d</h3>
<div class="paragraph">
<p>3D basic stuff (not yet related to X3D nodes). Includes basic T3D class, quaternions, axis-aligned bounding box types&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p><em>Depends on</em>: everything above.</p>
</div>
</div>
<div class="sect2">
<h3 id="_castlescript">1.9. castlescript</h3>
<div class="paragraph">
<p>Parsing and executing expressions and programs in the  <a href="http://castle-engine.sourceforge.net/castle_script.php">CastleScript language</a>.</p>
</div>
<div class="paragraph">
<p><em>Depends on</em>: everything above.</p>
</div>
</div>
<div class="sect2">
<h3 id="_x3d">1.10. x3d</h3>
<div class="paragraph">
<p>This is the core of our engine rendering and processing:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Scene, which means a graph of X3D nodes: rendering, reading, writing and processing (animating, collisions..). Reading many 2D and 3D formats to X3D scene graph.</p>
</li>
<li>
<p>Viewport to display 2D and 3D scenes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>Depends on</em>: everything above.</p>
</div>
</div>
<div class="sect2">
<h3 id="_game">1.11. game</h3>
<div class="paragraph">
<p>And high level units implementing game mechanics common for many games&#8201;&#8212;&#8201;creatures, items, player, levels.</p>
</div>
<div class="paragraph">
<p><em>Depends on</em>: everything above.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_castle_window_package">2. castle_window package</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_window">2.1. window</h3>
<div class="paragraph">
<p>TCastleWindow, easy window with an OpenGL context.</p>
</div>
<div class="paragraph">
<p><em>Depends on</em>: game, that is: everything above.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_castle_components_package">3. castle_components package</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_components">3.1. components</h3>
<div class="paragraph">
<p>TCastleControl, a Lazarus component to render with our engine.</p>
</div>
<div class="paragraph">
<p><em>Depends on</em>: game. (This is an alternative to TCastleWindow, so it has the same dependencies. Units between <code>window</code> and <code>components</code> group cannot use each other.)</p>
</div>
</div>
</div>
</div>
<h1 id="_opengl_units" class="sect0">OpenGL units</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>Most of the units groups have a subdirectory called <code>opengl</code>. The things that depend on OpenGL or OpenGLES (GL, GLU, GLExt, CastleGLES20 units&#8201;&#8212;&#8201;that should be used <em>only</em> by the CastleGL macro) must be placed inside this subdirectory. This guarantees that stuff outside the <code>opengl</code> subdirectory is independent from the rendering library.</p>
</div>
<div class="paragraph">
<p>Some of the unit groups are exceptions to the above rule: they do not have the <code>opengl</code> subdirectory, and all their units can freely use OpenGL. This applies to units in <code>game</code>, <code>window</code> or <code>component</code> groups. They all depend on other units already using OpenGL.</p>
</div>
<div class="paragraph">
<p>This order is maintained to be ready to implement another renderer in the Castle Game Engine some day. Maybe Direct 3D , maybe Vulkan, maybe Metal&#8230;&#8203; it all depends on the contributions, and on the needs of community. Note that making a first alternative renderer will also require remaking some stuff to use more "pluggable" architecture. Probably at that point some units will become "untangled" from depending on OpenGL stuff, for example most units in <code>game</code> and <code>x3d</code> will need to be available regardless of the renderer. The internal architecture of <code>TCastleScene</code> will need to be changed to call a renderer, without depending on OpenGL units.</p>
</div>
</div>
</div>