<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#_overview_and_examples">Overview and examples</a></li>
<li><a href="#_installing_android_tools">Installing Android tools</a>
<ul class="sectlevel1">
<li><a href="#_install_java">1. Install Java</a></li>
<li><a href="#_install_android_sdk">2. Install Android SDK</a></li>
<li><a href="#_adjust_environment_after_installing_sdk">3. Adjust environment after installing SDK</a></li>
<li><a href="#_install_android_sdk_components">4. Install Android SDK components</a></li>
<li><a href="#_install_android_ndk">5. Install Android NDK</a></li>
<li><a href="#_adjust_environment_after_installing_ndk">6. Adjust environment after installing NDK</a></li>
<li><a href="#_test_android_sdk_ndk_independently_of_pascal_and_cge">7. Test Android SDK + NDK independently of Pascal and CGE</a></li>
<li><a href="#_fpc_for_android">8. FPC for Android</a></li>
<li><a href="#_add_paths_to_ndk_libraries_for_fpc_configuration">9. Add paths to NDK libraries for FPC configuration</a></li>
<li><a href="#_test_compiling_and_running_mobile_demo">10. Test compiling and running mobile demo</a></li>
</ul>
</li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>You can create games (and other applications) for Android using our Castle Game Engine.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#overview-and-examples">Overview and examples</a></p>
</li>
<li>
<p><a href="#installing-android-tools">Installing Android tools</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="#install-java">Install Java</a></p>
</li>
<li>
<p><a href="#install-android-sdk">Install Android SDK</a></p>
</li>
<li>
<p><a href="#adjust-environment-after-installing-sdk">Adjust environment after installing SDK</a></p>
</li>
<li>
<p><a href="#install-android-sdk-components">Install Android SDK components</a></p>
</li>
<li>
<p><a href="#install-android-ndk">Install Android NDK</a></p>
</li>
<li>
<p><a href="#adjust-environment-after-installing-ndk">Adjust environment after installing NDK</a></p>
</li>
<li>
<p><a href="test-android-sdk&.html#8212;&#8203;ndk-independently-of-pascal-and-cge">Test Android SDK + NDK independently of Pascal and CGE</a></p>
</li>
<li>
<p><a href="#fpc-for-android">FPC for Android</a></p>
</li>
<li>
<p><a href="#add-paths-to-ndk-libraries-for-fpc-configuration">Add paths to NDK libraries for FPC configuration</a></p>
</li>
<li>
<p><a href="#test-compiling-and-running-mobile-demo">Test compiling and running mobile demo</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="Android FAQ" class="bare">Android FAQ</a></p>
</li>
<li>
<p><a href="Android SDK and NDK troubleshooting" class="bare">Android SDK and NDK troubleshooting</a></p>
</li>
</ul>
</div>
</div>
</div>
<h1 id="_overview_and_examples" class="sect0">Overview and examples</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>The description how to create a cross-platform project, that can work on Android (and other platforms) is in the manual: <a href="https://castle-engine.io/manual_mobile.php" class="bare">https://castle-engine.io/manual_mobile.php</a> . This page describes tools you need to install to make the building for Android work.</p>
</div>
<div class="paragraph">
<p>The engine sources include many examples, and many of them are cross-platform and can be tested on Android. In particular, check out:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>examples/mobile/simple_3d_demo/ - shows 3D world and navigation and graphic effects on Android,</p>
</li>
<li>
<p>examples/2d_dragon_spine_android_game/ - shows 2D animation and Google Play Games integration on Android,</p>
</li>
<li>
<p><a href="https://castle-engine.io/darkest_before_dawn.php" class="bare">https://castle-engine.io/darkest_before_dawn.php</a> - a complete 3D game, with full source code, for Android and standalone, using our engine.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Use the <a href="Build Tool">Build Tool</a> to easily compile these programs for Android (or other platforms&#8201;&#8212;&#8201;they all can be compiled as standalone games too!). But first be sure to install the Android tools described below. They will be called by the <a href="Build Tool">Build Tool</a> under the hood.</p>
</div>
</div>
</div>
<h1 id="_installing_android_tools" class="sect0">Installing Android tools</h1>
<div class="openblock partintro">
<div class="content">
To be able to develop Android application, you need some tools from Google, and you need FPC that can compile code to an Android.
</div>
</div>
<div class="sect1">
<h2 id="_install_java">1. Install Java</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Java is required by the Android SDK. Install Java <em>JDK (Java Development Kit)</em>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>On Debian or Ubuntu, you can install the <code>default-jdk</code> package that will pull in (as dependencies) the best <em>Java Development Kit</em> version. Or install directly a package like <code>openjdk-X-jdk</code>.</p>
</li>
<li>
<p>On Windows, download the latest version from <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html" class="bare">http://www.oracle.com/technetwork/java/javase/downloads/index.html</a> . Just google for "Java JDK download" if this link doesn&#8217;t work:) You usually want to install the latest version, like <em>Java SE Development Kit 8uXXX</em>. By default, it will be installed in <code>C:\Program Files\Java\jdk1.8.0_XXX</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>For users who install full Android Studio</em>: You do not need to install Java separately. The complete <em>Android Studio</em> will already include Java version suitable for Android SDK. You will want to set <code>JAVA_HOME</code> environment variable later to something like</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>C:/Program Files/Android/Android Studio/jre</code> on Windows</p>
</li>
<li>
<p><code>&lt;wherever-you-unpacked-android-studio-targz&gt;/jre</code> on Linux</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_install_android_sdk">2. Install Android SDK</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Download and install Android SDK from <a href="http://developer.android.com/sdk/index.html" class="bare">http://developer.android.com/sdk/index.html</a> .</p>
</div>
<div class="paragraph">
<p>You can:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Install the whole <em>Android Studio and SDK Tools</em> (main download on the above page). This is easier (some configuration can be then done using GUI), and thus is advised for new users.</p>
<div class="paragraph">
<p>Location of the Android SDK is visible in the Android Studio <em>Settings -&gt; Android SDK</em>, on Windows it looks like <code>C:\Users\&lt;my-user-name&gt;\AppData\Local\Android\Sdk</code>. The NDK will be installed there too, in <code>ndk-bundle</code> subdirectory. You may need to know this location for the next steps.</p>
</div>
</li>
<li>
<p>Or you can install only the <em>Command line tools only</em> (see the bottom of the above page). The rest can be installed using the <code>sdkmanager</code> on the command-line, see our instructions below. This allows to download less, but you will have to work more with the command-line.</p>
<div class="paragraph">
<p>Make sure to unpack the tools under <code>cmdline-tools</code> subdirectory of the <code>$ANDROID_HOME</code>, and move everything under additional subdirectory <code>latest</code>, so you have a file like <code>$ANDROID_HOME/cmdline-tools/latest/bin/sdkmanager</code>.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_adjust_environment_after_installing_sdk">3. Adjust environment after installing SDK</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Set <code>$ANDROID_HOME</code> environment variable, to point to your Android SDK directory. This is recognized by both our build tool, and some Android tools.</p>
</li>
<li>
<p>Consider adding to <code>$PATH</code> the <code>&lt;android-sdk&gt;/platform-tools/</code> directory. In Castle Game Engine &gt; 6.0.2, this is not necessary (engine doesn&#8217;t need it), but still advised: it allows you to call <code>adb</code> on the command-line easily, which is often useful.</p>
</li>
<li>
<p>Set <code>$JAVA_HOME</code> environment variable, to point to your newly installed <em>Java Development Kit (JDK)</em>. This is required by the Android build tools.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you don&#8217;t know what an <em>"environment variable"</em> is, google <em>"how to set environment variable in windows/linux/&#8230;&#8203;"</em> :) Remember to reopen the relevant application (e.g. close and reopen the terminal) to see the newly set environment variables.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_install_android_sdk_components">4. Install Android SDK components</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Install some components of the Android <em>SDK Manager</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The GUI version of the <em>SDK Manager</em> is part of the <em>Android Studio</em>.</p>
<div class="ulist">
<ul>
<li>
<p>Run <em>Android Studio</em>. If you see a wizard prompting you to create a new project&#8201;&#8212;&#8201;you can cancel it. Then choose <em>Configure &#8594; SDK Manager</em>.</p>
<div class="imageblock">
<div class="content">
<a class="image" href="https://castle-engine.io/images/original_size/sdk_manager_1.png"><img src="https://castle-engine.io/images/thumb_size/sdk_manager_1.png" alt="Android SDK Manager 1"></a>
</div>
</div>
</li>
<li>
<p>Make sure that it knows the correct path to the Android SDK. You may need to <em>Edit</em> the SDK location if you installed (or want to install) to a non-standard path.</p>
</li>
<li>
<p>On the <em>"SDK Platforms"</em> tab (1st tab) select <em>"Android 10.0 (Q) - API 29"</em> (be sure to use this exact version). Check <em>"Show Package Details"</em> at the bottom to see more, make sure that inside the <em>"Android 10.0 (Q) - API 29"</em> section the <em>"Android SDK Platform 29"</em> and <em>"Google APIs"</em> subcomponents are selected.</p>
<div class="paragraph">
<p>TODO: Screenshots below show older situation, for API 23. In new CGE 6.5, just use API 29 instead.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="https://castle-engine.io/images/original_size/sdk_manager_2.png"><img src="https://castle-engine.io/images/thumb_size/sdk_manager_2.png" alt="Android SDK Manager 2"></a>
</div>
</div>
</li>
<li>
<p>On the <em>"SDK Tools"</em> tab (2nd tab), select the <em>"Android SDK Build-tools"</em> version 29.0.3 (actually any 29.0.x should be OK). Check <em>"Show Package Details"</em> at the bottom to be able to select the exact <em>"Android SDK Build-tools"</em> version. Be sure to install <em>this exact version</em> (not earlier, not later). You can install other versions too, they don&#8217;t conflict, but you must install this exact version too.</p>
<div class="paragraph">
<p>TODO: Screenshots below show older situation, for API 23. In new CGE 6.5, just use API 29 instead.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="https://castle-engine.io/images/original_size/sdk_manager_3.png"><img src="https://castle-engine.io/images/thumb_size/sdk_manager_3.png" alt="Android SDK Manager 3"></a>
</div>
</div>
</li>
<li>
<p>Also on the <em>"SDK Tools"</em> tab (2nd tab), select "NDK".</p>
</li>
<li>
<p>Also on the <em>"SDK Tools"</em> tab (2nd tab), from the section <em>"Support Repository"</em> (usually at the bottom of the list), make sure <em>"Android Support Repository"</em> and <em>"Google Repository"</em> are selected.</p>
<div class="imageblock">
<div class="content">
<a class="image" href="https://castle-engine.io/images/original_size/sdk_manager_4.png"><img src="https://castle-engine.io/images/thumb_size/sdk_manager_4.png" alt="Android SDK Manager 4"></a>
</div>
</div>
</li>
<li>
<p>Click <em>OK</em>, choose <em>Accept</em> at the license question.</p>
</li>
</ul>
</div>
</li>
<li>
<p>If you prefer to <strong>use the command-line</strong>, you can alternatively download only <em>Android SDK command-line tools</em>. Set <code>$ANDROID_HOME</code> environment variable, and then execute</p>
<div class="listingblock">
<div class="content">
<pre>  cd $ANDROID_HOME
  ./cmdline-tools/latest/bin/sdkmanager --install \
    'platform-tools' \
    'platforms;android-29' \
    'extras;google;google_play_services' \
    'build-tools;29.0.3' \
    'extras;android;m2repository' \
    'ndk-bundle'</pre>
</div>
</div>
<div class="paragraph">
<p>Remember to use apostrophes as shown above.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you know what you&#8217;re doing, you can actually use other versions of SDK components (other versions of <em>"SDK Platform"</em> and <em>"Android SDK Build-tools"</em>). You will need to declare them on a per-project basis in <code>CastleEngineManifest.xml</code>, see <a href="Build Tool">Build Tool</a>. But it&#8217;s probably easiest if you use their default versions at the beginning.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_install_android_ndk">5. Install Android NDK</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Android NDK should already be installed under the <code>ndk-bundle</code> subdirectory of Android SDK, if you followed the above steps :) Both the <em>GUI version of the SDK Manager</em> and the command-line <code>sdkmanager</code> install NDK, as described above.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_adjust_environment_after_installing_ndk">6. Adjust environment after installing NDK</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Set <code>$ANDROID_NDK_HOME</code> environment variable, to indicate the directory of NDK. It should be just inside the <code>&lt;android-sdk&gt;/ndk-bundle</code> directory. Our build tool can figure it out automatically (testing <code>$ANDROID_HOME/ndk-bundle</code>), but Google tools really need <code>$ANDROID_NDK_HOME</code>.</p>
</li>
<li>
<p>To <code>$PATH</code> add:</p>
<div class="ulist">
<ul>
<li>
<p>The NDK subdirectory containing Android/Arm binutils (like <code>arm-linux-androideabi-as</code>, <code>arm-linux-androideabi-ld</code>) suitable for your source platform. For example <code>&lt;android-sdk&gt;/ndk-bundle/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64/bin</code> . Where "<code class="code">arm-linux-androideabi-4.9</code>" is the Android platform version, just choose latest "<code class="code">arm-linux-androideabi-XXX</code>". And the "<code class="code">prebuilt/linux-x86_64</code>" corresponds to the real OS where you are now (you probably have only one subdirectory inside "<code class="code">prebuilt/</code>" anyway, the one for which you downloaded NDK). Use "<code class="code">linux-x86_64</code>" if you work on Linux 64-bit, adjust for other systems as necessary.</p>
</li>
<li>
<p>The NDK subdirectory containing Android/Aarch64 binutils. Similar to above, e.g. <code>${ANDROID_NDK_HOME}toolchains/aarch64-linux-android-4.9/prebuilt/linux-x86_64/bin/</code>.</p>
</li>
<li>
<p>(Optional, mostly useful if you want to use x86_64 emulators/virtual machines.) The NDK subdirectory containing Android/x86_64 binutils. Similar to above, e.g. <code>${ANDROID_NDK_HOME}toolchains/x86_64-4.9/prebuilt/linux-x86_64/bin/</code>.</p>
</li>
<li>
<p>(Optional, as above.) The NDK subdirectory containing Android/x86 binutils. Similar to above, e.g. <code>${ANDROID_NDK_HOME}toolchains/x86-4.9/prebuilt/linux-x86_64/bin/</code>.</p>
</li>
<li>
<p>Also consider adding to <code>$PATH</code> the main NDK directory (with <code>ndk-build</code> and <code>ndk-gdb</code> tools inside). In Castle Game Engine &gt; 6.0.2, this is not necessary (the engine build tool doesn&#8217;t need it), but it may be comfortable for you anyway (if you plan to use command-line <code>ndk-gdb</code>).</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, when compiling Android application from Linux/x86_64, the environment variables as below make sense:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>export CASTLE_ENGINE_PATH="${HOME}"/castle-engine/
export ANDROID_HOME="${HOME}/android-sdk/"
export ANDROID_NDK_HOME="${ANDROID_HOME}/ndk-bundle/"
export PATH="${PATH}:\
${ANDROID_HOME}platform-tools/:\
${ANDROID_NDK_HOME}:\
${ANDROID_NDK_HOME}toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64/bin/:\
${ANDROID_NDK_HOME}toolchains/aarch64-linux-android-4.9/prebuilt/linux-x86_64/bin/"
${ANDROID_NDK_HOME}toolchains/x86-4.9/prebuilt/linux-x86_64/bin/:\
${ANDROID_NDK_HOME}toolchains/x86_64-4.9/prebuilt/linux-x86_64/bin/:\
export JAVA_HOME="/usr/lib/jvm/java-11-openjdk-amd64/"</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_test_android_sdk_ndk_independently_of_pascal_and_cge">7. Test Android SDK + NDK independently of Pascal and CGE</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>While this step is optional, it is often a good idea to try, especially when troubleshooting problems:</em></p>
</div>
<div class="paragraph">
<p>Test compiling (and deploying to your actual Android device) some example code from the Android NDK.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>This allows to make sure that you configured everything correctly, before you start playing with combining Object Pascal code + Android. This allows to detect problems in your setup (or in the latest Android SDK/NDK&#8201;&#8212;&#8201;these things happen) that are not related to FPC or CGE.</p>
</li>
<li>
<p>If you run into trouble, consult <a href="Android SDK and NDK troubleshooting" class="bare">Android SDK and NDK troubleshooting</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For this, you can compile and install (on a real Android device, typically connected through USB) the "hello-gl2" demo from Android NDK.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Download it from GitHub, like this:</p>
<div class="listingblock">
<div class="content">
<pre>  git clone https://github.com/googlesamples/android-ndk android-ndk-samples</pre>
</div>
</div>
</li>
<li>
<p>Compile the example code by this command-line:</p>
<div class="listingblock">
<div class="content">
<pre>  cd android-ndk-samples/hello-gl2/

  # On Windows platforms, type this command:
  gradlew.bat assembleDebug

  # On Mac OS and Linux platforms, type these commands:
  chmod +x gradlew
  ./gradlew assembleDebug

  # See https://developer.android.com/studio/build/building-cmdline.html .
  # The first run will take a long time, as gradle downloads it's components.
  # This should create a file app/build/outputs/apk/app-debug.apk

  # Check that your device is connected, enable "USB debugging" and authorize it if needed
  adb devices
  # Install the application (use -r to reinstall)
  adb install app/build/outputs/apk/app-debug.apk
  # Or install using gradle:
  ./gradlew installDebug</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>And then run the resulting application (it is called "GL2JNI") on your device. It should work equally well on a real Android device, or in the Android emulator.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_fpc_for_android">8. FPC for Android</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You need a special version of FPC (Free Pascal Compiler, <a href="http://freepascal.org/" class="bare">http://freepascal.org/</a>): a cross-compiler to Android. This means that FPC can run on your normal OS/processor (Linux, Windows, macOS&#8230;&#8203;) and can produce binaries for Android. "Android" more precisely means "<em>Android OS (based on Linux) + Android processor (32-bit <code>arm</code> or 64-bit <code>aarch64</code>, for emulators also <code>x64_64</code> is useful)</em>".</p>
</div>
<div class="paragraph">
<p>You need to use <strong>FPC &gt;= 3.0.2</strong> for Android compilation. <em>Reasons</em>: The <em>PIC support</em> for Android libraries is not implemented in earlier FPC versions, and it&#8217;s required when using Android SDK &gt;= 23, see <a href="http://wiki.freepascal.org/Android" class="bare">http://wiki.freepascal.org/Android</a> . We recommend using latest stable, FPC 3.2.2.</p>
</div>
<div class="paragraph">
<p><strong>The easiest way to get a cross-compiler for Android is to use <a href="fpcupdeluxe">fpcupdeluxe</a>. I advise it, instead of the manual process described below. Use <a href="fpcupdeluxe">fpcupdeluxe</a> to get latest FPC for Android.</strong></p>
</div>
<div class="paragraph">
<p>As an alternative, below we describe how to manually compile latest FPC 3.3.1 for Android:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Make sure you have installed the latest stable FPC version (3.2.2 at the time of this writing), it is required to compile (bootstrap) new FPC version.</p>
</li>
<li>
<p>Get and compile FPC from GitLab.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here&#8217;a an example how to do it from the command-line.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>git clone https://gitlab.com/freepascal.org/fpc/source fpcsrc
cd fpcsrc/

# Of course adjust INSTALL_PREFIX below.
# -CfVFPV3 is necessary for hard floats, this way the engine works much faster.
make clean crossall crossinstall OS_TARGET=android CPU_TARGET=arm CROSSOPT="-CfVFPV3" INSTALL_PREFIX=$HOME/installed/fpc/android
make clean crossall crossinstall OS_TARGET=android CPU_TARGET=aarch64 INSTALL_PREFIX=$HOME/installed/fpc/android

# 2 commands below are optional,
# as x86 Android versions are practically useful in Android emulators/virtual machines and not required otherwise.
make clean crossall crossinstall OS_TARGET=android CPU_TARGET=x86 INSTALL_PREFIX=$HOME/installed/fpc/android
make clean crossall crossinstall OS_TARGET=android CPU_TARGET=x86_64 INSTALL_PREFIX=$HOME/installed/fpc/android

# It is also advised to compile and install a "normal" FPC binaries and units,
# not cross-compiling,
# for compiling to your normal OS with the same FPC version.
make clean all install INSTALL_PREFIX=$HOME/installed/fpc/android

# On Unix (not on Windows), this is also useful for comfort:
cd $HOME/installed/fpc/android/bin
ln -s ../lib/fpc/3.3.1/ppcrossarm .
ln -s ../lib/fpc/3.3.1/ppcrossa64 .
ln -s ../lib/fpc/3.3.1/ppcrossx64 . # this is only relevant if your main FPC is 32-bit
ln -s ../lib/fpc/3.3.1/ppc386     . # this is only relevant if your main FPC is 32-bit

# On Windows, it is useful to copy some helper binaries from the last stable FPC release.
# These include:
# - windres
# - gcc, cpp</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>See <a href="http://wiki.freepascal.org/Android" class="bare">http://wiki.freepascal.org/Android</a> for links to more info.</p>
</li>
<li>
<p>Remember to first download the last stable FPC compiler, to bootstrap the compilation.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_add_paths_to_ndk_libraries_for_fpc_configuration">9. Add paths to NDK libraries for FPC configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Add paths to NDK dirs to your ~/.fpc.cfg (see <a href="http://www.freepascal.org/docs-html/user/usersu10.html" class="bare">http://www.freepascal.org/docs-html/user/usersu10.html</a> if you&#8217;re unsure where&#8217;s your configuration file; you can create a new one using "fpcmkcfg" program). This way FPC will find the correct NDK tools to link your programs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>#ifdef ANDROID

  # 32-bit Android CPUs
  #ifdef CPUARM
  -Fl&lt;android-sdk&gt;/ndk-bundle/toolchains/llvm/prebuilt/linux-x86_64/sysroot/usr/lib/arm-linux-androideabi/16/
  #endif
  #ifdef CPU386
  -Fl&lt;android-sdk&gt;/ndk-bundle/toolchains/llvm/prebuilt/linux-x86_64/sysroot/usr/lib/i686-linux-android/16/
  #endif

  # 64-bit Android CPUs
  #ifdef CPUAARCH64
  -Fl&lt;android-sdk&gt;/ndk-bundle/toolchains/llvm/prebuilt/linux-x86_64/sysroot/usr/lib/aarch64-linux-android/21/
  #endif
  #ifdef CPUX86_64
  -Fl&lt;android-sdk&gt;/ndk-bundle/toolchains/llvm/prebuilt/linux-x86_64/sysroot/usr/lib/x86_64-linux-android/21/
  #endif

#endif</pre>
</div>
</div>
<div class="paragraph">
<p>Also, double check that your FPC config does not contain any weird -XP option. FPC can correctly determine it at runtime, and having it set in config file does more harm than good&#8201;&#8212;&#8201;unless you know what it does and why you use it.</p>
</div>
<div class="paragraph">
<p>Note that the lines above point to NDK platform version <code>16</code> (for 32-bit CPUs). Yes, use exactly this version. This is the NDK platform version, and it should correspond to the <code>min_sdk_version</code> in <a href="CastleEngineManifest.xml-examples">CastleEngineManifest.xml</a>. It is a <em>different</em> number than the <code>compile_sdk_version</code> (and the SDK platform version you installed).</p>
</div>
<div class="paragraph">
<p>For 64-bit CPUs, these lines point to NDK platform version <code>21</code>, earliest version with 64-bit CPU support.</p>
</div>
<div class="paragraph">
<p>If you use <a href="fpcupdeluxe">fpcupdeluxe</a>, it is safest to remove/rename it&#8217;s <code>&lt;fpcupdeluxe&gt;/cross/lib/arm-android/</code> and <code>&lt;fpcupdeluxe&gt;/cross/lib/arch64-android/</code>. This way we make sure to use NDK platform version <code>16</code> (32-bit) / <code>21</code> (64-bit).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_test_compiling_and_running_mobile_demo">10. Test compiling and running mobile demo</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You should have everything set up now. Let&#8217;s try compiling and running our mobile demo application, in <code>examples/mobile/simple_3d_demo/</code> .</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>First compile and run a normal standalone version, in simple_3d_demo_standalone.lpr . Just compile and run it as usual, using Lazarus or "simple_3d_demo_standalone_compile.sh" script (which simply executes FPC from command-line with proper options).</p>
</li>
<li>
<p>Then compile a standalone version using our <a href="Build Tool">Build Tool</a>, by calling</p>
<div class="listingblock">
<div class="content">
<pre> castle-engine compile</pre>
</div>
</div>
</li>
<li>
<p>Now compile the Android application using our <a href="Build Tool">Build Tool</a>, by caling</p>
<div class="listingblock">
<div class="content">
<pre> castle-engine compile --target=android</pre>
</div>
</div>
<div class="paragraph">
<p>This should create <code>libsimple_3d_demo.so</code> file, using FPC for Android and Android NDK tools.</p>
</div>
</li>
<li>
<p>If all is well, go one step further, create an Android package using</p>
<div class="listingblock">
<div class="content">
<pre> castle-engine package --target=android</pre>
</div>
</div>
<div class="paragraph">
<p>This recompiles a release version and creates a ready <code>simple_3d_demo.apk</code> file that you can install on your Android device.</p>
</div>
</li>
<li>
<p>You can install and run the apk if your Android phone is connected to your computer (through USB cable).</p>
<div class="paragraph">
<p>Make sure that the "<em>USB Debugging</em>" is turned on in the "<em>Development Settings</em>" on your Android phone or tablet. The official information how to do it from Google is on <a href="https://developer.android.com/studio/run/device.html" class="bare">https://developer.android.com/studio/run/device.html</a> (ignore mentions of <code>build.gradle</code> there, the build tool hides it from you). In case of trouble, search google about it, some devices have special ways to enable it. Keep trying until <code>"adb devices"</code> shows your device&#8201;&#8212;&#8201;it is necessary to make further commands work.</p>
</div>
<div class="listingblock">
<div class="content">
<pre> adb devices # should show your device in response
 castle-engine install --target=android
 castle-engine run --target=android</pre>
</div>
</div>
<div class="paragraph">
<p>These commands install and run the application using Android SDK tools underneath. They show the log of your running application, which is very useful for testing.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>At this point, you have a ready apk file, which you can upload / install / run just like any other application, using any Android tool. You can also upload it to Google Play and release your game! Go for it!:)</p>
</div>
</div>
</div>