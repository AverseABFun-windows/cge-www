# Logging
include::common.adoc[]

## Introduction

- Use cgeref:CastleLog[] unit.
- Call cgeref:WritelnLog[] to make a normal log message (with information).
- Call cgeref:WritelnWarning[] to make a warning message.

NOTE: Logging can be initialized by cgeref:InitializeLog[]. But if you follow our advised structure of a cross-platform project, then it is automatically done for you, in the initialization of `castleautogenerated.pas` unit, for all the platforms. So, no need to worry about this.

Some engine functions also automatically write to this log. For example, creating the OpenGL context logs the OpenGL and GPU features detected.

## An example

[source,pascal]
----
include::../code-samples/logging.lpr[]
----

The category `'My Category'`, used by the call `WritelnLog('My Category', 'My Log Message')`, is useful to spot/filter your log messages. There are no rules about what categories are available, you're free to just invent own category names and use them.

## Capturing

You can capture the log messages by adding a callback to the cgeref:TCastleApplicationProperties.OnLog[TCastleApplicationProperties.OnLog] list. Like this:

[source,pascal]
----
ApplicationProperties.OnLog.Add({$ifdef FPC}@{$endif} MyLogCallback);
----

See https://github.com/castle-engine/castle-engine/tree/master/examples/network/remote_logging[examples/network/remote_logging] for an example that captures log messages, and sends them through a network (HTTP POST) to a server.

## Where is the log stored?

- When running from link:manual_editor.php[CGE editor], the log is displayed in the bottom editor panel.

- When running using link:build_tool[CGE build tool `castle-engine run` command], the log is displayed as the standard output.

- When running the application as a normal user:
+
--
- _On Unix (Linux, macOS...), and for Windows console applications_, logging by default goes to the _standard output_. This is the standard behavior for Unix and console apps.
+
Users can redirect it by running the application from the command-line like `my_game > log_file.log`. The nice thing about this approach is that it avoids users asking questions _"where is the log file"_. Users explicitly decide where the log goes.
+
If you don't want to produce log to the standard output (and prefer to always log to file, as described below) then set cgeref:LogEnableStandardOutput[] to `false`.

- _For Windows GUI applications_, or if you set `LogEnableStandardOutput := false`, we log to the file in the user config directory.
** On Windows the file name looks like `C:\Users\<user-name>\AppData\Local\<application-name>\<application-name>.log`.
** On Unix the file name looks like `$HOME/.config/<application-name>\<application-name>.log`.

+
The exact logic to determine the _user config directory_ follows FPC https://www.freepascal.org/docs-html/rtl/sysutils/getappconfigdir.html:[GetAppConfigDir]. This uses the appropriate OS-specific mechanism (e.g. asks the Windows API function, or follows link:https://freedesktop.org/wiki/Software/xdg-user-dirs/[xdg-user-dirs] conventions). You can display the `LogOutput` value to show user on screen where is the log file.

- _On Android_ the log goes to the standard device log. It that can be viewed using various Android tools, like `adb logcat`.

- _On iOS, Nintendo Switch_ it goes to the standard log facility for these devices.
--

- User can call the application with `--log-file=c:/tmp/my_log_name.txt` command-line option to set the log filename explicitly.
+
This sets the cgeref:LogFileName[] variable which will be used by subsequent cgeref:InitializeLog[]. This command-line option is handled when you call cgeref:TCastleApplication.ParseStandardParameters[Application.ParseStandardParameters], which in turn is done automatically in the `castleautogenerated.pas` unit. So you just don't need to do anything to make this possible.

- _Deprecated:_ If you write your own main program code (not using our `castleautogenerated.pas` unit) then you call cgeref:InitializeLog[] explicitly. You can then pass a parameter to `InitializeLog` to write log to any stream. You can also set `LogFileName` variable before calling the `InitializeLog`. This way you force using specific filename for logging, overriding the OS-specific auto-detection mechanism described above.
