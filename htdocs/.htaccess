# rewrites -------------------------------------------------------------------

RewriteEngine On

# Redirect www domain to non-www
# See https://www.digitalocean.com/community/tutorials/how-to-redirect-www-to-non-www-with-apache-on-ubuntu-14-04
RewriteBase /
RewriteCond %{HTTP_HOST} ^www\.(.*)$ [NC]
RewriteRule ^(.*)$ https://%1/$1 [R=301,L]

# Rewrite to use doc.php=xxx for names not refering to any existing file (in particular, not refering to PHP files).
# Based on Wordpress rewrite rule, see also https://httpd.apache.org/docs/current/mod/mod_rewrite.html
#
# If you access CGE website like http://localhost/~michalis/castle-engine/ (useful for Michalis development)
# RewriteBase /~michalis/castle-engine/
# If you access CGE website like https://castle-engine.io/ (useful for production), use this:
RewriteBase /
#
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . doc.php?page=%{REQUEST_URI} [L]

# redirects ------------------------------------------------------------------

# Redirect latest.zip to latest.zip.php (interpreted by PHP to redirect
# further, to a known latest version).
# See https://httpd.apache.org/docs/current/mod/mod_alias.html#redirect
Redirect "/latest.zip" "/latest.zip.php"

# old things, redirect to closest new things
Redirect "/miscella/win32_dlls.zip" "https://github.com/castle-engine/castle-engine/tree/master/tools/build-tool/data/external_libraries"
Redirect "/miscella/forest.tar.gz" "https://github.com/castle-engine/demo-models/tree/master/lights_materials/vrml_1/forest-fog"
Redirect "/abbreviated_x3d_specs_for_users.chm" "https://castle-engine.io/vrml_x3d.php"
Redirect "/kambiscript_language.chm" "https://castle-engine.io/castle_script.php"

# Redirect kambi-php-lib, to keep PasDoc-generated docs accessing this working
# (in CGE release too, before we fixed https://github.com/castle-engine/castle-engine/issues/59 )
Redirect "/kambi-php-lib/" "/castle-engine-website-base/"

# Unknown who contains this invalid link,
# but our redirect seems stuck at this point,
# Google Search Console reports "redirect error" and indeed opening this
# in Firefox or wget causes redirect error.
Redirect "/engine.php/creating_data_intro.php" "/"

# PHP config -----------------------------------------------------------------

php_value upload_max_filesize 64M
php_value post_max_size 64M
